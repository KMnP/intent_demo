<!DOCTYPE HTML>
<html>
	<head>
		<title>Images with different motives</title>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1" />
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
        <script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.10.3/jquery-ui.min.js"></script>
        <link rel="stylesheet" href="https://code.jquery.com/ui/1.10.4/themes/smoothness/jquery-ui.css" />
		<script>
            STATIC_ROOT = "https://intentology.s3.us-east-2.amazonaws.com/intent_annotation/static";
            // STATIC_ROOT = "static"
            $('<link>').attr('rel','stylesheet')
              .attr('type','text/css')
              .attr('href',STATIC_ROOT + '/assets/css/main.css')
              .appendTo('head');
        </script>
		<!-- <link rel="stylesheet" href="assets/css/main.css" /> -->
	</head>
	<body>
		<!-- Collapsible instructions -->
		<button class="collapsible">Instructions <i>(Best view in a full screen setting)</i> </button>
			<div class="collapsible-content">
			  <p>Place instructions here...(good example, bad example?)</p>
			  <p>You will be given a product and asked whether a particular attribute (e.g., brand or color) is important when shopping for this or similar items.

An attribute is considered important for a given product if it influences your purchasing decision. For example, you are willing to pay a little bit more for a particular brand of an electric toothbrush, then for you, brand is important for electric toothbrushes. In another example, suppose that you would only consider white shoes when buying running shoes. In this case, color is an important attribute for running shoes.

If the product has no such attribute (e.g., car seats do not have flavor), choose "does not apply". If the product has the attribute but it does not affect your decision (e.g., you do not care the bar code value of car seats), choose "No".

What if I never post this kind of images before? You can use common sense to judge attribute importance (i.e., whether other people who bought this product will think the attribute is important). If you have difficulty judging attribute importance for the product, you can answer “not sure”. Please also indicate your past shopping experience after the 3 questions about attributes.</p>
			</div>

		<div class="page-wrap" style="max-width:1680px;">
			<!-- Main -->
				<section id="main">
					<!-- Task Descriptions -->
						<section id="section">
							<div class="inner">
								<p style="font-size:110%;">Imagine the image below on the left is the one you really want to share in Instagram.<br />
								But you cannot do it (due to what?).<br />
								Click on any images on the right that <strong><font color="RED">you can easily dismiss</font></strong>, leaving the ones that convey similar intent.
								<!-- Can you choose from the images on the right that convey <strong><font color="Tomato">different motive</font></strong>? -->
							</p>
							</div>
						</section>

					<!-- Selections -->
						<section id="selections">
							<!-- put query image here -->
								<div class="social column">
									<h3>Image you want to post</h3>
									<span class="image fit special"><div id='query-container'></div></span>
								</div>

							<!-- Grid -->
								<div class="column">
									<h3>Please <font color="RED">click on the images to select</font>, double-click to remove selection.</h3>
									<div class="gallery">
										<div class="content">
											<!-- row 1 -->
											<div class="media">
												<span class="image fit"><div class='image-container'></div></span>
											</div>
											<div class="media">
												<span class="image fit"><div class='image-container'></div></span>
											</div>
											<div class="media">
												<span class="image fit"><div class='image-container'></div></span>
											</div>
											<div class="media">
												<span class="image fit"><div class='image-container'></div></span>
											</div>

											<!-- row 2 -->
											<div class="media">
												<span class="image fit"><div class='image-container'></div></span>
											</div>
											<div class="media">
												<span class="image fit"><div class='image-container'></div></span>
											</div>
											<div class="media">
												<span class="image fit"><div class='image-container'></div></span>
											</div>
											<div class="media">
												<span class="image fit"><div class='image-container'></div></span>
											</div>

											<!-- row 3 -->
											<div class="media">
												<span class="image fit"><div class='image-container'></div></span>
											</div>
											<div class="media">
												<span class="image fit"><div class='image-container'></div></span>
											</div>
											<div class="media">
												<span class="image fit"><div class='image-container'></div></span>
											</div>
											<div class="media">
												<span class="image fit"><div class='image-container'></div></span>
											</div>

											<!-- row 4 -->
											<div class="media">
												<span class="image fit"><div class='image-container'></div></span>
											</div>
											<div class="media">
												<span class="image fit"><div class='image-container'></div></span>
											</div>
											<div class="media">
												<span class="image fit"><div class='image-container'></div></span>
											</div>
											<div class="media">
												<span class="image fit"><div class='image-container'></div></span>
											</div>

										</div>
									</div>
								</div>
						</section>
						<!-- Footer for buttons-->
							<footer id="footer">
								<div class='col-xs-4 col-xs-offset-4 text-center' id='button-div'>
									<button id='prev-btn' class='btn btn-lg btn-primary' disabled>Back</button>
									<span id='counter'>
									<span class='counter-top'></span> / <span class='counter-bottom'></span>
									</span>
									<button id='next-btn' class='btn btn-lg btn-primary' disabled>Next</button>
								</div>
								<div class='col-xs-4 col-xs-offset-4 text-center' id='button-div'>
								    <input type='submit' class='btn btn-lg btn-success' id='submit-btn' value='Submit' disabled/>
								</div>
							</footer>
				</section>
		</div>

		<!-- Scripts -->
		<script>
		  STATIC_ROOT = "https://intentology.s3.us-east-2.amazonaws.com/intent_annotation/static";
		  // STATIC_ROOT = "../static";
		  $.getScript(STATIC_ROOT + '/assets/js/jquery.min.js');
		  $.getScript(STATIC_ROOT + '/assets/js/jquery.poptrox.min.js');
		  $.getScript(STATIC_ROOT + '/assets/js/jquery.scrolly.min.js');
		  $.getScript(STATIC_ROOT + '/assets/js/skel.min.js');
		  $.getScript(STATIC_ROOT + '/assets/js/util.js');
		  $.getScript(STATIC_ROOT + '/assets/js/main.js');
		  $.getScript(STATIC_ROOT + '/assets/js/collapsible.js');
		</script>
    <script type='text/json' id='input'>
  [["https://intentology.s3.us-east-2.amazonaws.com/intent_annotation/static/images/fulls/01.jpg", "https://intentology.s3.us-east-2.amazonaws.com/intent_annotation/static/images/fulls/02.jpg", "https://intentology.s3.us-east-2.amazonaws.com/intent_annotation/static/images/fulls/03.jpg", "https://intentology.s3.us-east-2.amazonaws.com/intent_annotation/static/images/fulls/04.jpg", "https://intentology.s3.us-east-2.amazonaws.com/intent_annotation/static/images/fulls/05.jpg", "https://intentology.s3.us-east-2.amazonaws.com/intent_annotation/static/images/fulls/06.jpg", "https://intentology.s3.us-east-2.amazonaws.com/intent_annotation/static/images/fulls/07.jpg", "https://intentology.s3.us-east-2.amazonaws.com/intent_annotation/static/images/fulls/08.jpg", "https://intentology.s3.us-east-2.amazonaws.com/intent_annotation/static/images/fulls/09.jpg", "https://intentology.s3.us-east-2.amazonaws.com/intent_annotation/static/images/fulls/10.jpg", "https://intentology.s3.us-east-2.amazonaws.com/intent_annotation/static/images/fulls/11.jpg", "https://intentology.s3.us-east-2.amazonaws.com/intent_annotation/static/images/fulls/12.jpg", "https://intentology.s3.us-east-2.amazonaws.com/intent_annotation/static/images/fulls/16.jpg", "https://intentology.s3.us-east-2.amazonaws.com/intent_annotation/static/images/fulls/15.jpg", "https://intentology.s3.us-east-2.amazonaws.com/intent_annotation/static/images/fulls/13.jpg", "https://intentology.s3.us-east-2.amazonaws.com/intent_annotation/static/images/fulls/14.jpg"], ["https://intentology.s3.us-east-2.amazonaws.com/intent_annotation/static/images/fulls/20.jpg", "https://intentology.s3.us-east-2.amazonaws.com/intent_annotation/static/images/fulls/23.jpg", "https://intentology.s3.us-east-2.amazonaws.com/intent_annotation/static/images/fulls/24.jpg", "https://intentology.s3.us-east-2.amazonaws.com/intent_annotation/static/images/fulls/32.jpg", "https://intentology.s3.us-east-2.amazonaws.com/intent_annotation/static/images/fulls/19.jpg", "https://intentology.s3.us-east-2.amazonaws.com/intent_annotation/static/images/fulls/27.jpg", "https://intentology.s3.us-east-2.amazonaws.com/intent_annotation/static/images/fulls/21.jpg", "https://intentology.s3.us-east-2.amazonaws.com/intent_annotation/static/images/fulls/17.jpg", "https://intentology.s3.us-east-2.amazonaws.com/intent_annotation/static/images/fulls/28.jpg", "https://intentology.s3.us-east-2.amazonaws.com/intent_annotation/static/images/fulls/25.jpg", "https://intentology.s3.us-east-2.amazonaws.com/intent_annotation/static/images/fulls/18.jpg", "https://intentology.s3.us-east-2.amazonaws.com/intent_annotation/static/images/fulls/26.jpg", "https://intentology.s3.us-east-2.amazonaws.com/intent_annotation/static/images/fulls/29.jpg", "https://intentology.s3.us-east-2.amazonaws.com/intent_annotation/static/images/fulls/31.jpg", "https://intentology.s3.us-east-2.amazonaws.com/intent_annotation/static/images/fulls/30.jpg", "https://intentology.s3.us-east-2.amazonaws.com/intent_annotation/static/images/fulls/22.jpg"], ["https://intentology.s3.us-east-2.amazonaws.com/intent_annotation/static/images/fulls/36.jpg", "https://intentology.s3.us-east-2.amazonaws.com/intent_annotation/static/images/fulls/43.jpg", "https://intentology.s3.us-east-2.amazonaws.com/intent_annotation/static/images/fulls/45.jpg", "https://intentology.s3.us-east-2.amazonaws.com/intent_annotation/static/images/fulls/38.jpg", "https://intentology.s3.us-east-2.amazonaws.com/intent_annotation/static/images/fulls/46.jpg", "https://intentology.s3.us-east-2.amazonaws.com/intent_annotation/static/images/fulls/47.jpg", "https://intentology.s3.us-east-2.amazonaws.com/intent_annotation/static/images/fulls/48.jpg", "https://intentology.s3.us-east-2.amazonaws.com/intent_annotation/static/images/fulls/40.jpg", "https://intentology.s3.us-east-2.amazonaws.com/intent_annotation/static/images/fulls/34.jpg", "https://intentology.s3.us-east-2.amazonaws.com/intent_annotation/static/images/fulls/33.jpg", "https://intentology.s3.us-east-2.amazonaws.com/intent_annotation/static/images/fulls/37.jpg", "https://intentology.s3.us-east-2.amazonaws.com/intent_annotation/static/images/fulls/39.jpg", "https://intentology.s3.us-east-2.amazonaws.com/intent_annotation/static/images/fulls/41.jpg", "https://intentology.s3.us-east-2.amazonaws.com/intent_annotation/static/images/fulls/42.jpg", "https://intentology.s3.us-east-2.amazonaws.com/intent_annotation/static/images/fulls/44.jpg", "https://intentology.s3.us-east-2.amazonaws.com/intent_annotation/static/images/fulls/35.jpg"]]
</script>
<script type='text/json' id='query'>
  ["https://images.unsplash.com/photo-1565363887211-f84e8598833a?ixlib=rb-1.2.1&ixid=eyJhcHBfaWQiOjEyMDd9&auto=format&fit=crop&w=1301&q=80", "https://images.unsplash.com/photo-1565363887211-f84e8598833a?ixlib=rb-1.2.1&ixid=eyJhcHBfaWQiOjEyMDd9&auto=format&fit=crop&w=1301&q=80", "https://images.unsplash.com/photo-1565363887211-f84e8598833a?ixlib=rb-1.2.1&ixid=eyJhcHBfaWQiOjEyMDd9&auto=format&fit=crop&w=1301&q=80"]
</script>

<form id='results-form' method='post' action='dummy' class='text-center'>
  <input type='hidden' value='' name='output' id='output'/>
  <input type="hidden" id="hitId" name="hitId" value='MTURK_HIT_ID'>
  <input type="hidden" id="assignmentId" name="assignmentId" value='MTURK_ASSIGNMENT_ID'>
  <!-- <div class='col-xs-4 col-xs-offset-4 text-center' id='button-div'>
    <input type='submit' class='btn btn-lg btn-success' id='submit-btn' value='Submit' disabled/>
  </div>
 --></form>
<script>
  var simpleamt = (function() {

    // Copied from http://james.padolsey.com/javascript/bujs-1-getparameterbyname/
    function getUrlParam(name) {
      var match = RegExp('[?&]' + name + '=([^&]*)').exec(window.location.search);
      return match ? decodeURIComponent(match[1].replace(/\+/g, ' ')) : null;
    }

    function getQuery(default_query) {
      if (typeof(default_query) === 'undefined') default_query = null;
      try {
        return JSON.parse($('#query').html());
      } catch (e) {
        console.log(e)
        console.log($('#query').html())
        return default_query;
      }
    }

    function getInput(default_input) {
      if (typeof(default_input) === 'undefined') default_input = null;
      try {
        return JSON.parse($('#input').html());
      } catch (e) {
        console.log(e)
        console.log($('#input').html())
        return default_input;
      }
    }

    function setOutput(output) {
      $('#output').val(JSON.stringify(output));
    }

    function isPreview() {
      var assignment_id = getUrlParam('assignmentId');
      if (assignment_id === null) return true;
      return assignment_id == 'ASSIGNMENT_ID_NOT_AVAILABLE';
    }

    function setupSubmit() {
      var submit_to = getUrlParam('turkSubmitTo');
      $('#results-form').attr('action', submit_to + '/mturk/externalSubmit');
      $('#assignmentId').val(getUrlParam('assignmentId'));
      $('#worker_id').val(getUrlParam('workerId'));
    }

    return {
      getQuery: getQuery,
      getInput: getInput,
      setOutput: setOutput,
      isPreview: isPreview,
      setupSubmit: setupSubmit,
    }

  })();
</script>

    <script>
      $(function() {
        // Define some default input.
        // var STATIC_ROOT = "https://intentology.s3.us-east-2.amazonaws.com/intent_annotation/static"
        var DEFAULT_QUERY = [];

        var DEFAULT_INPUT = [];

        var query = null;
        var input = null;

        // responses from users, parallel to input.
        var responses = [];

        // Some variables to track state of the HIT.
        var idx = 0;
        var enabled = false;

        // Output
        var output = {}

        function main() {
          // If this is a HIT on AMT, then replace the default input with the real input.
          query = simpleamt.getQuery(DEFAULT_QUERY)

          // input for grid images
          input = simpleamt.getInput(DEFAULT_INPUT);

          // Enable the UI if the HIT is not in preview mode.
          if (!simpleamt.isPreview()) {
            enable_hit();
          } else {
          	test();
          }

          // Set up the responses for each query.
          $.each(query, function (){
            responses.push([]);
          });

          // Preload all images
          // var imgs = [];
          // $.each(query, function(img_url) {
          //   var img = new Image();
          //   img.onload = function() { console.log('loaded image from ' + img_url); };
          //   img.src = img_url;
          // });

          render();
        }

        // Use the current index to update the image and description
        function render() {
          console.log(idx)
          // Set up the image
          $('#query-container').empty();
          $('<img>').attr({'src': query[idx]}).appendTo($('#query-container'));
          console.log('loaded proxy image from ' + query);

          // Set up the grid
          $('.image-container').each(function(index){
          	$(this).empty();
            $('<img>').attr({'src': input[idx][index]}).appendTo($(this));
            console.log('loaded image from ' + input[idx][index]);
          });


          // Refresh the counter
          $('.counter-top').text(idx + 1);
          $('.counter-bottom').text(input.length);

          // Set the media according to responses
          $(".media").filter(".selected").removeClass('selected');
          if (responses[idx].length !== 0) {
          	// set up the grid according to previous selection
          	$('.media').each(function(){
          	  $img = $(this).find('img');
          	  // if this image is in the responses
          	  if(jQuery.inArray($img.attr('src'), responses[idx]) !== -1) {
                $(this).addClass('selected');
          	  }
	        })
          } else {
          	responses[idx] = [];
          }

          // If the UI is enabled, enable or disable the buttons 
          // depending on the index.
          if (enabled) {
            var prev_btn = $('#prev-btn');
            var next_btn = $('#next-btn');
            var submit_btn = $('#submit_btn')
            prev_btn.prop('disabled', true);
            next_btn.prop('disabled', true);
            submit_btn.prop('disabled', true)
            if (idx > 0) {
              prev_btn.prop('disabled', false);
            }
            if (idx < query.length - 1) next_btn.prop('disabled', false);
            if !(idx < query.length - 1) submit_btn.prop('disabled', false);
          }

        }

        // Update the index, and save the clicked responses from gallery.
        function set_idx(new_idx) {
          if (new_idx < 0 || new_idx >= input.length) return;

          $('.selected').each(function(){
          	$img = $(this).find('img');
          	// add to the responses if not in array
          	if(jQuery.inArray($img.attr('src'), responses[idx]) === -1) {
              responses[idx].push($img.attr('src'))
            }
	        })
	        // console.log(responses)
          if (responses[idx].length < 1) {
            alert('No image selected. Correct before continue.');
            return false;
          }
          
          idx = new_idx;
          render();
        }

        function set_idx_back(new_idx) {
          if (new_idx < 0 || new_idx >= input.length) return;

          $('.selected').each(function(){
            $img = $(this).find('img');
            // add to the responses if not in array
            if(jQuery.inArray($img.attr('src'), responses[idx]) === -1) {
              responses[idx].push($img.attr('src'))
            }
          })
          idx = new_idx;
          render();
        }

        // Test the output
        function test() {
          enabled = true;
          // Enable components
          $('#next-btn').click(function() { set_idx(idx + 1) });
          $('#prev-btn').click(function() { set_idx_back(idx - 1) });
          // $('#submit-btn').prop('disabled', false);

          $('#submit-btn').click(function() {
            alert('This is for demo purpose. No responses will be submitted. You can view the results in console.');
          	// clear responses
  	        responses[idx] = [];
          	$('.selected').each(function(){
          	  $img = $(this).find('img');
              responses[idx].push($img.attr('src'))
            })

            // if (_.any(responses, function(d) { return d.length < 1; })) {
            //   alert('No image selected. Correct before continue.. Correct before submitting.');
            //   return false;
            // }

            if (responses[idx].length < 1) {
              alert('No image selected. Correct before submitting.');
              return false;
            }

            var output = _.map(_.zip(query, responses), function(x) {
              return {'target': x[0], 'responses': x[1]};
            });
            console.log(output)
          });
        }
        // Enable the UI.
        function enable_hit() {
          enabled = true;

          // Enable components
          $('#next-btn').click(function() { set_idx(idx + 1) });
          $('#prev-btn').click(function() { set_idx(idx - 1) });
          // $('#submit-btn').prop('disabled', false);

          // Set up submit handler.
          simpleamt.setupSubmit();
          $('#submit-btn').click(function() {
          	responses[idx] = [];
          	$('.selected').each(function(){
          	  $img = $(this).find('img');
              responses[idx].push($img.attr('src'))
	          })

            if (responses[idx].length < 1) {
              alert('No image selected. Correct before continue.');
              return false;
            }
            var output = _.map(_.zip(query, responses), function(x) {
              return {'target': x[0], 'responses': x[1]};
            });
            simpleamt.setOutput(output);
          });
        }

        main();
      });
    </script>

	</body>
</html>