<!DOCTYPE HTML>
<html>
  <head>
    <title>Images with different motives</title>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
        <script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.10.3/jquery-ui.min.js"></script>
        <link rel="stylesheet" href="https://code.jquery.com/ui/1.10.4/themes/smoothness/jquery-ui.css" />
    <script>
            STATIC_ROOT = "https://intentology.s3.us-east-2.amazonaws.com/intent_annotation/static";
            // STATIC_ROOT = "static"
            $('<link>').attr('rel','stylesheet')
              .attr('type','text/css')
              .attr('href',STATIC_ROOT + '/assets/css/main.css')
              .appendTo('head');
        </script>
    <!-- <link rel="stylesheet" href="assets/css/main.css" /> -->
  </head>
  <body>
    <!-- Splash page -->
    <div id="splashscreen">
      <div class="inner">
        <h1>Welcome to this study! (scroll down to continue)</h1>
        <p>
          Suppose you took a photo that you’d like to share on Instagram, but for various reasons (e.g., privacy or licensing concerns), you’re <u>not allowed to post it</u>. You had a certain intent or motivation in mind when taking the photo that you wanted to express by posting it.
        </p>
        <p>
          Now suppose that, instead of posting nothing, you have the opportunity to <u>post an alternative photo that expresses as similar intent as possible</u>.
        </p>
        <p>
          The following tasks capture this idea, and allow you to express your opinion on which photos could be good substitutes in this respect.
        </p>
        <p>
          Note1: please think beyond the motive of "look how great a good photographer I am". Let's assume all the images are well-photographed.
        </p>
        <p>
          Note2: sometimes, you need to think beyond the simple content of the image. Images with <u>same scene and/or similar content</u> can have <u>different motives</u> (examples below).
        </p>
        <div class="image left">
          <img src="https://intentology.s3.us-east-2.amazonaws.com/intent_annotation/static/images/s1-answer.png" alt="examples">
        </div>
        <div class="image right">
          <img src="https://intentology.s3.us-east-2.amazonaws.com/intent_annotation/static/images/s2-answer.png" alt="examples">
        </div>
        <div class="image fit">
          <img src="https://intentology.s3.us-east-2.amazonaws.com/intent_annotation/static/images/s3-answer.png" alt="examples">
        </div>
        <div class='col-xs-4 col-xs-offset-4 text-center' id='button-splash'>
          <button id='continue-btn' class='btn btn-lg btn-primary' >Click to continue</button>
        </div>
      </div>
    </div>

    <!-- The Modal for zoomed in probe images -->
    <div id="myModal" class="modal">

      <!-- The Close Button -->
      <span class="close">&times;</span>

      <!-- Modal Content (The Image) -->
      <img class="modal-content" id="enlargedImg">

      <!-- Modal Caption (Image Text) -->
      <div id="probeCaption"></div>
    </div>

    <!-- Collapsible instructions -->
    <button class="collapsible">Click for More Instructions <i>(Best view in a full screen setting)</i> </button>
      <div class="collapsible-content">
        <p>
          Suppose you took a photo that you’d like to share on Instagram, but for various reasons (e.g., privacy or licensing concerns), you’re not allowed to post it. You had a certain intent or motivation in mind when taking the photo that you wanted to express by posting it. <br />
          Now suppose that, instead of posting nothing, you have the opportunity to <strong>post an alternative photo that expresses as similar intent as possible</strong>. <br />
          The following tasks capture this idea, and allow you to express your opinion on which photos could be good substitutes in this respect.
        </p>
        <p>
          Note 1: please think beyond the motive of "look how great a good photographer I am". Let's assume all the images are well-photographed.
        </p>
        <p>
          Note 2: sometimes, you need to <strong>think beyond the simple content of the image</strong>. Images with same scene and/or similar content can have different motives (examples below).
        </p>
        <div class="image left">
          <img src="https://intentology.s3.us-east-2.amazonaws.com/intent_annotation/static/images/s1-answer.png" alt="examples">
        </div>
        <div class="image right">
          <img src="https://intentology.s3.us-east-2.amazonaws.com/intent_annotation/static/images/s2-answer.png" alt="examples">
        </div>
        <div class="image fit">
          <img src="https://intentology.s3.us-east-2.amazonaws.com/intent_annotation/static/images/s3-answer.png" alt="examples">
        </div>
      </div>

    <div class="page-wrap" style="max-width:1680px; margin:0 auto;">
      <!-- Main -->
        <section id="main">
          <!-- Task Descriptions -->
            <section id="section">
              <div class="inner">
                <p style="font-size:110%;">
                  Click to dismiss any image that <strong><font color="RED">wouldn’t serve as a good substitute</font></strong> for the intent of the image on the left. <br />
                  If none of them are good fits, feel free to dismiss all of them.
                  Note: please think beyond the motive of "look how great a good photographer I am". Let's assume all the images are well-photographed.
              </p>
              </div>
            </section>

          <!-- Selections -->
            <section id="selections">
              <!-- put query image here -->
                <div class="social column">
                  <h3>Carefully examine images below (photos you want to post). Click to view full size image.</h3>
                  <span class="image fit special">
                    <div id='query-container'></div>
                  </span>
                  <!-- <div class="probe">
                    <span class="image fit special">
                      <a href="https://images.unsplash.com/photo-1432888498266-38ffec3eaf0a?ixlib=rb-1.2.1&ixid=eyJhcHBfaWQiOjEyMDd9&auto=format&fit=crop&w=2106&q=80"><img src="https://images.unsplash.com/photo-1432888498266-38ffec3eaf0a?ixlib=rb-1.2.1&ixid=eyJhcHBfaWQiOjEyMDd9&auto=format&fit=crop&w=2106&q=80" alt="" title="Images you want to post." /></a>
                    </span>
                 </div> -->
                </div>

              <!-- Grid -->
                <div class="column">
                  <!-- <h3>Click on any images on the right that <strong><font color="RED">you can easily dismiss</font></strong>, leaving the ones that convey similar intent.</h3> -->
                  <h3>Please <font color="RED">click on the images to select</font>, <font color="LIMEGREEN">double-click to remove selection</font>. Scroll down to see more images.</h3>
                  <div class="gallery">
                    <div class="content">
                      <div class="media" style="width: 48%;">
                        <span class="image fit"><div class='image-container'></div></span>
                      </div>
                      <div class="media" style="width: 48%;">
                        <span class="image fit"><div class='image-container'></div></span>
                      </div>
                      <div class="media" style="width: 48%;">
                        <span class="image fit"><div class='image-container'></div></span>
                      </div>
                      <div class="media" style="width: 48%;">
                        <span class="image fit"><div class='image-container'></div></span>
                      </div>
                    </div>
                  </div>
                </div>
            </section>
            <!-- Footer for buttons-->
              <footer id="footer">
                <div class='col-xs-4 col-xs-offset-4 text-center' id='button-div'>
                  <button id='prev-btn' class='btn btn-lg btn-primary' disabled>Back</button>
                  <span id='counter'>
                  <span class='counter-top'></span> / <span class='counter-bottom'></span>
                  </span>
                  <button id='next-btn' class='btn btn-lg btn-primary' disabled>Next</button>
                </div>
              </footer>
        </section>
    </div>

    <!-- Scripts -->
    <script>
      STATIC_ROOT = "https://intentology.s3.us-east-2.amazonaws.com/intent_annotation/static";
      // STATIC_ROOT = "../static";
      $.getScript(STATIC_ROOT + '/assets/js/jquery.min.js');
      $.getScript(STATIC_ROOT + '/assets/js/jquery.scrolly.min.js');
      $.getScript(STATIC_ROOT + '/assets/js/skel.min.js');
      $.getScript(STATIC_ROOT + '/assets/js/util.js');
      $.getScript(STATIC_ROOT + '/assets/js/main.js');
      $.getScript(STATIC_ROOT + '/assets/js/collapsible.js');
      $.getScript(STATIC_ROOT + '/assets/js/splash.js');
      $.getScript(STATIC_ROOT + '/assets/js/probe.js');
    </script>
    <script type='text/json' id='input'>
  [["https://intentology.s3.us-east-2.amazonaws.com/images/low/f3383def9e05235df048f6a5773f0b10.jpg", "https://intentology.s3.us-east-2.amazonaws.com/images/low/dd318bf89bb7d15b1b1c77bfb4b5e2ba.jpg", "https://intentology.s3.us-east-2.amazonaws.com/images/low/02dc0836896d7d70545b933748bd0bdd.jpg", "https://intentology.s3.us-east-2.amazonaws.com/images/low/09f23798fb125ec34d5554cdfa6982af.jpg"], ["https://intentology.s3.us-east-2.amazonaws.com/images/low/a6aa34e6fa6272c3b60f966988fbe98b.jpg", "https://intentology.s3.us-east-2.amazonaws.com/images/low/cdcf2cafa16b0865613a607b72f7d7de.jpg", "https://intentology.s3.us-east-2.amazonaws.com/images/low/c6e8887bbe65eb6885acfd55b0ddcedb.jpg", "https://intentology.s3.us-east-2.amazonaws.com/images/low/6a41a803caa2435b09dedb20e39afff9.jpg"], ["https://intentology.s3.us-east-2.amazonaws.com/images/low/6832baacde93f7758bbf35bfd6e2289c.jpg", "https://intentology.s3.us-east-2.amazonaws.com/images/low/7945f93a0257b755efc0ec2a67b840ca.jpg", "https://intentology.s3.us-east-2.amazonaws.com/images/low/abfe49df082c47f302d3b991b5efeee6.jpg", "https://intentology.s3.us-east-2.amazonaws.com/images/low/02a265d0a993cb71ed2b0db2ae3d9efb.jpg"], ["https://intentology.s3.us-east-2.amazonaws.com/images/low/c01d01bc0e96dc983de9db91268c9005.jpg", "https://intentology.s3.us-east-2.amazonaws.com/images/low/cd7652e27c8592d7c59019129143c9f9.jpg", "https://intentology.s3.us-east-2.amazonaws.com/images/low/43d950dec0a462ba28944e83408481f2.jpg", "https://intentology.s3.us-east-2.amazonaws.com/images/low/ac2364be6c8fb1de78e7b9d35ed91b0b.jpg"], ["https://intentology.s3.us-east-2.amazonaws.com/images/low/741f43fedbc0900c0bf1e0dfd2bc013c.jpg", "https://intentology.s3.us-east-2.amazonaws.com/images/low/9bbfeb69e8abbf5f77336645c9dd2b07.jpg", "https://intentology.s3.us-east-2.amazonaws.com/images/pilot/catch_trials/explore/2.png", "https://intentology.s3.us-east-2.amazonaws.com/images/low/169d67d8876b6121969d17378c8a99eb.jpg"], ["https://intentology.s3.us-east-2.amazonaws.com/images/low/5b8f8eb0078ccbfec3e0d8de333641f2.jpg", "https://intentology.s3.us-east-2.amazonaws.com/images/low/cda815f3559616adc66fd9cede264e3c.jpg", "https://intentology.s3.us-east-2.amazonaws.com/images/low/1c4299bd24e63be5ad5206e086451c75.jpg", "https://intentology.s3.us-east-2.amazonaws.com/images/low/0ad6838f5f660470358c978e661c535c.jpg"], ["https://intentology.s3.us-east-2.amazonaws.com/images/low/3737e38bba6fe57145c56a84dcbdbdf3.jpg", "https://intentology.s3.us-east-2.amazonaws.com/images/low/c3b514a0ec5dafa7690c828118bf5f90.jpg", "https://intentology.s3.us-east-2.amazonaws.com/images/low/3afbe427aec0c3da6134cf744fcace0f.jpg", "https://intentology.s3.us-east-2.amazonaws.com/images/low/9e45ff449f6d2a7d62f1c9bd3848ce9a.jpg"], ["https://intentology.s3.us-east-2.amazonaws.com/images/low/1cafd9b0991418c612ea96b1beaca014.jpg", "https://intentology.s3.us-east-2.amazonaws.com/images/low/e107b16c567cddde28967f371ee35028.jpg", "https://intentology.s3.us-east-2.amazonaws.com/images/low/e197e8375f27db5c0d48ff5964e6362e.jpg", "https://intentology.s3.us-east-2.amazonaws.com/images/low/5ca210b55ce720f22b9c5e9ca2e84248.jpg"], ["https://intentology.s3.us-east-2.amazonaws.com/images/low/592e6b91d9a90e9d126cb4ee8256fc98.jpg", "https://intentology.s3.us-east-2.amazonaws.com/images/low/f5672b6c62885b4d1d48821a9f2df3aa.jpg", "https://intentology.s3.us-east-2.amazonaws.com/images/low/2839201e2c6df8d00a373a68dd2bc8dc.jpg", "https://intentology.s3.us-east-2.amazonaws.com/images/low/86b19b855b5f0d9c9670e3576f15142e.jpg"], ["https://intentology.s3.us-east-2.amazonaws.com/images/low/169ece44163b611c5cfd0f1fc9ccdbce.jpg", "https://intentology.s3.us-east-2.amazonaws.com/images/low/e776280df6e2b358eed3f06e08e2d740.jpg", "https://intentology.s3.us-east-2.amazonaws.com/images/low/21c95c5560d2bc7269b00119fdd7fef8.jpg", "https://intentology.s3.us-east-2.amazonaws.com/images/low/0da44d9313bb023d8a77cb7e351709e4.jpg"], ["https://intentology.s3.us-east-2.amazonaws.com/images/low/ff4ff9b8bf9a35293fee2970009dc816.jpg", "https://intentology.s3.us-east-2.amazonaws.com/images/low/dd05986dc03fd2369a59b36fce3f9356.jpg", "https://intentology.s3.us-east-2.amazonaws.com/images/low/c118385f94432d28f86107e94ef5a1c1.jpg", "https://intentology.s3.us-east-2.amazonaws.com/images/low/9aac873783487cf6c2996351b114b6c3.jpg"], ["https://intentology.s3.us-east-2.amazonaws.com/images/low/0602fa3d050499d3cf0d28045d0e232a.jpg", "https://intentology.s3.us-east-2.amazonaws.com/images/low/2055e08965725e55c0d01828eeb43f55.jpg", "https://intentology.s3.us-east-2.amazonaws.com/images/low/2ec1a773ee6090a2ecdb2f8dbdd14739.jpg", "https://intentology.s3.us-east-2.amazonaws.com/images/low/0bc419b0512919af60699a2524ed8456.jpg"]]
</script>
<script type='text/json' id='query'>
  ["https://intentology.s3.us-east-2.amazonaws.com/images/pilot/probes/explore/3.png", "https://intentology.s3.us-east-2.amazonaws.com/images/pilot/probes/explore/3.png", "https://intentology.s3.us-east-2.amazonaws.com/images/pilot/probes/explore/3.png", "https://intentology.s3.us-east-2.amazonaws.com/images/pilot/probes/explore/3.png", "https://intentology.s3.us-east-2.amazonaws.com/images/pilot/probes/explore/3.png", "https://intentology.s3.us-east-2.amazonaws.com/images/pilot/probes/explore/3.png", "https://intentology.s3.us-east-2.amazonaws.com/images/pilot/probes/explore/3.png", "https://intentology.s3.us-east-2.amazonaws.com/images/pilot/probes/explore/3.png", "https://intentology.s3.us-east-2.amazonaws.com/images/pilot/probes/explore/3.png", "https://intentology.s3.us-east-2.amazonaws.com/images/pilot/probes/explore/3.png", "https://intentology.s3.us-east-2.amazonaws.com/images/pilot/probes/explore/3.png", "https://intentology.s3.us-east-2.amazonaws.com/images/pilot/probes/explore/3.png"]
</script>

<form id='results-form' method='post' action='dummy' class='text-center'>
  <input type='hidden' value='' name='output' id='output'/>
  <input type="hidden" id="assignmentId" name="assignmentId" value='MTURK_ASSIGNMENT_ID'>
  <div class='col-xs-4 col-xs-offset-4 text-center' id='button-div'>
    <input type='submit' class='btn btn-lg btn-success' id='submit-btn' value='Submit' disabled/>
  </div>
</form>
<script>
  var simpleamt = (function() {

    // Copied from http://james.padolsey.com/javascript/bujs-1-getparameterbyname/
    function getUrlParam(name) {
      var match = RegExp('[?&]' + name + '=([^&]*)').exec(window.location.search);
      return match ? decodeURIComponent(match[1].replace(/\+/g, ' ')) : null;
    }

    function getQuery(default_query) {
      if (typeof(default_query) === 'undefined') default_query = null;
      try {
        return JSON.parse($('#query').html());
      } catch (e) {
        console.log($('#query').html())
        return default_query;
      }
    }

    function getInput(default_input) {
      if (typeof(default_input) === 'undefined') default_input = null;
      try {
        return JSON.parse($('#input').html());
      } catch (e) {
        console.log($('#input').html())
        return default_input;
      }
    }

    function setOutput(output) {
      $('#output').val(JSON.stringify(output));
    }

    function isPreview() {
      var assignment_id = getUrlParam('assignmentId');
      if (assignment_id === null) return true;
      // if (assignment_id === null) return false;
      return assignment_id == 'ASSIGNMENT_ID_NOT_AVAILABLE';
    }

    function setupSubmit() {
      var submit_to = getUrlParam('turkSubmitTo');
      $('#results-form').attr('action', submit_to + '/mturk/externalSubmit');
      $('#assignmentId').val(getUrlParam('assignmentId'));
    }

    return {
      getQuery: getQuery,
      getInput: getInput,
      setOutput: setOutput,
      isPreview: isPreview,
      setupSubmit: setupSubmit,
    }

  })();
</script>

    <script>
      $(function() {
        // Define some default input.
        // var STATIC_ROOT = "https://intentology.s3.us-east-2.amazonaws.com/intent_annotation/static"
        var DEFAULT_QUERY = [];

        var DEFAULT_INPUT = [];

        var query = null;
        var input = null;

        // responses from users, parallel to input.
        var responses = [];

        // Some variables to track state of the HIT.
        var idx = 0;
        var enabled = false;

        // Output
        var output = {}

        function main() {
          // If this is a HIT on AMT, then replace the default input with the real input.
          query = simpleamt.getQuery(DEFAULT_QUERY)

          // input for grid images
          input = simpleamt.getInput(DEFAULT_INPUT);

          // Enable the UI if the HIT is not in preview mode.
          // if (!simpleamt.isPreview()) {
          //   enable_hit();
          // }
          if (!simpleamt.isPreview()) {
            enable_hit();
          } else {
            test();
          }

          // Set up the responses for each query.
          $.each(query, function (){
            responses.push([]);
          });

          // Preload all images
          // var imgs = [];
          $.each(query, function(query_idx, value){
            $.each(input[query_idx], function(i, img_url) {
              var img = new Image();
              img.onload = function() {
                // console.log('loaded image from ' + img_url);
              };
              // img.src = img_url + "?t=" + new Date().getTime();
              img.src = img_url;
            });
          });

          render();
        }

        // Use the current index to update the image and description
        function render() {
          // scroll up to the top
          document.body.scrollTop = 0;
          document.documentElement.scrollTop = 0;
          // console.log(idx)
          // Set up the probe image
          $('#query-container').empty();
          $('<img>').attr({'src': query[idx], 'id': "myProbe", 'alt': "These are the images you want to post. Click the upper right button to return"}).appendTo($('#query-container'));
          // console.log('render: loaded proxy image from ' + query);

          // Set up click info
          var modal = document.getElementById("myModal");

          // Get the image and insert it inside the modal - use its "alt" text as a caption
          var probeImg = document.getElementById("myProbe");
          // var imgContainer = document.getElementById("query-container")
          var modalImg = document.getElementById("enlargedImg");
          var captionText = document.getElementById("probeCaption");
          probeImg.onclick = function(){
            modal.style.display = "block";
            modalImg.src = this.src;
            captionText.innerHTML = this.alt;
          }

          // Set up the grid
          $('.image-container').each(function(index){
            $(this).empty();
            $('<img>').attr({'src': input[idx][index]}).appendTo($(this));
            // console.log('render: loaded image from ' + input[idx][index]);
          });


          // Refresh the counter
          $('.counter-top').text(idx + 1);
          $('.counter-bottom').text(input.length);

          // Set the media according to responses
          $(".media").filter(".selected").removeClass('selected');
          if (responses[idx].length !== 0) {
            // set up the grid according to previous selection
            $('.media').each(function(){
              $img = $(this).find('img');
              // if this image is in the responses
              if(jQuery.inArray($img.attr('src'), responses[idx]) !== -1) {
                $(this).addClass('selected');
              }
          })
          } else {
            responses[idx] = [];
          }

          // If the UI is enabled, enable or disable the buttons
          // depending on the index.
          if (enabled) {
            var prev_btn = $('#prev-btn');
            var next_btn = $('#next-btn');
            var submit_btn = $('#submit-btn');
            prev_btn.prop('disabled', true);
            next_btn.prop('disabled', true);
            submit_btn.prop('disabled', false);
            if (idx > 0) {
              prev_btn.prop('disabled', false);
            }
            if (idx < query.length - 1) {
              next_btn.prop('disabled', false);
              submit_btn.prop('disabled', true);
            }
          }
        }

        // Update the index, and save the clicked responses from gallery.
        function set_idx(new_idx) {
          if (new_idx < 0 || new_idx >= input.length) return;

          // clear responses in case user deselect any
          responses[idx] = [];
          // console.log(responses)
          $('.selected').each(function(){
            $img = $(this).find('img');
            responses[idx].push($img.attr('src'))
            // add to the responses if not in array
            // if(jQuery.inArray($img.attr('src'), responses[idx]) === -1) {
            //   responses[idx].push($img.attr('src'))
            // }
          })

          if (responses[idx].length < 1) {
            alert('No image selected at this page. Correct before continue.');
            return false;
          }
          idx = new_idx;
          render();
        }

        function set_idx_back(new_idx) {
          if (new_idx < 0 || new_idx >= input.length) return;

          // clear responses in case user deselect any
          responses[idx] = [];
          $('.selected').each(function(){
            $img = $(this).find('img');
            responses[idx].push($img.attr('src'))
            // add to the responses if not in array
            // if(jQuery.inArray($img.attr('src'), responses[idx]) === -1) {
            //   responses[idx].push($img.attr('src'))
            // }
          })
          idx = new_idx;
          render();
        }

        // Test the output
        function saveText(text, filename){
            var a = document.createElement('a');
            a.setAttribute('href', 'data:text/plain;charset=utf-u,'+encodeURIComponent(text));
            a.setAttribute('download', filename);
            a.click()
          }

        function test() {
          enabled = true;
          // Enable components
          $('#next-btn').click(function() { set_idx(idx + 1) });
          $('#prev-btn').click(function() { set_idx_back(idx - 1) });
          if (idx == query.length - 1) {
              $('#submit-btn').prop('disabled', false);
          }

          $('#submit-btn').click(function() {
            // clear responses
            responses[idx] = [];
            $('.selected').each(function(){
              $img = $(this).find('img');
              responses[idx].push($img.attr('src'))
            })

            if (responses[idx].length < 1) {
              alert('No image selected at this page. Correct before submitting.');
              return false;
            }

            var output = query.map(function(q, i) {
              return {'target': q, 'responses': responses[i]};
            });
            console.log(output)
            var d = new Date().toISOString()
            saveText( JSON.stringify(output), d + "_gallery4.json" );
            // $.ajax({
            //     type : "POST",
            //     url : "/mnt/vol/gfsai-east/ai-group/teams/amlcv_nyc/users/menglin/intent/save_json.php",
            //     data : {
            //         json : JSON.stringify(output)
            //     }
            // });
            alert('This is for demo purpose. Responses will be downloaded locally. Do not be alert by the next page');
          });
        }
        // Enable the UI.
        function enable_hit() {
          enabled = true;

          // Enable components
          $('#next-btn').click(function() { set_idx(idx + 1) });
          $('#prev-btn').click(function() { set_idx(idx - 1) });
          $('#submit-btn').prop('disabled', false);
          if (idx == query.length - 1) {
              $('#submit-btn').prop('disabled', false);
          }

          // Set up submit handler.
          simpleamt.setupSubmit();
          $('#submit-btn').click(function() {
            // clear responses
            responses[idx] = [];
            $('.selected').each(function(){
              $img = $(this).find('img');
              responses[idx].push($img.attr('src'))
            })

            if (responses[idx].length < 1) {
              // Validate the output
              alert('No image selected at this page. Correct before submitting.');
              return false;
            } else {
              // prepare output
              var output = query.map(function(q, i) {
                return {'target': q, 'responses': responses[i]};
              });
              simpleamt.setOutput(output);
            }
          });
        }

        main();
      });
    </script>

  </body>
</html>